From 2e1fe451c535394e3f12c04cca8b31357ade6c5c Mon Sep 17 00:00:00 2001
From: Bastian Blank <waldi@debian.org>
Date: Mon, 21 Nov 2016 19:10:46 +0100
Subject: Make Azure datasource run without root

Forwarded: https://bugs.launchpad.net/cloud-init/+bug/1536961
---
 cloudinit/sources/DataSourceAzure.py | 13 +++++++++----
 1 file changed, 9 insertions(+), 4 deletions(-)

diff --git a/cloudinit/sources/DataSourceAzure.py b/cloudinit/sources/DataSourceAzure.py
index c5af8b84..0314b869 100644
--- a/cloudinit/sources/DataSourceAzure.py
+++ b/cloudinit/sources/DataSourceAzure.py
@@ -206,10 +206,15 @@ class DataSourceAzureNet(sources.DataSource):
             LOG.debug("using files cached in %s", ddir)
 
         # azure / hyper-v provides random data here
-        seed = util.load_file("/sys/firmware/acpi/tables/OEM0",
-                              quiet=True, decode=False)
-        if seed:
-            self.metadata['random_seed'] = seed
+        try:
+            seed = util.load_file("/sys/firmware/acpi/tables/OEM0",
+                                  quiet=True, decode=False)
+            if seed:
+                self.metadata['random_seed'] = seed
+
+        # Don't fail if we can't read this file
+        except IOError:
+            pass
 
         # now update ds_cfg to reflect contents pass in config
         user_ds_cfg = util.get_cfg_by_path(self.cfg, DS_CFG_PATH, {})
